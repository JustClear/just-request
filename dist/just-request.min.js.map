{"version":3,"file":"just-request.min.js","sources":["../src/common.js","../src/index.js"],"sourcesContent":["export function toJSON(string) {\n    try {\n        return JSON.parse(string);\n    } catch (e) {\n        return string;\n    }\n}\n\nexport function querify(object) {\n    if (typeof object === 'string') return object;\n    return Object.keys(object).reduce((prev, current) => (prev ? `${prev}&` : ``) + encodeURIComponent(current) + '=' + encodeURIComponent(object[current]), '');\n}\n\nexport function setHeaders(xhr, headers) {\n    headers = headers || {};\n\n    if (!hasContentType(headers)) headers['Content-Type'] = 'application/x-www-form-urlencoded';\n\n    Object.keys(headers).map(name => headers[name] && xhr.setRequestHeader(name, headers[name]));\n}\n\nexport function hasContentType(headers) {\n    return Object.keys(headers).some(name => name.toLowerCase() === 'content-type');\n}\n\nexport function getURL(options) {\n    if (options.method.toLowerCase() !== 'get' || !options.data) return options.url;\n\n    const queryString = querify(options.data);\n    const separator = options.url.indexOf('?') > -1 ? '&' : '?';\n\n    return options.url + separator + queryString;\n}\n","import { querify, setHeaders, hasContentType, toJSON, getURL } from './common';\n\nexport default function request(options) {\n    if (typeof options === 'string') {\n        options = {};\n        options.url = arguments[0];\n    }\n    options = options || {};\n    options.data = options.data || {};\n    options.method = options.method || 'get';\n\n    const methods = ['get', 'post', 'put', 'delete'];\n\n    if (options.url) return connect(options);\n\n    return methods.reduce((request, method) => {\n        request[method] = (url, data = {}) => connect(Object.assign(options, {\n            method,\n            url,\n            data,\n        }));\n        return request;\n    }, {\n        then: () => {\n            console.log('use request().methodName() to specify request method');\n            return Object.assign({\n                catch: () => {},\n            });\n        },\n    });\n}\n\nfunction connect(options) {\n    const xhr = new XMLHttpRequest();\n    const promifyMethods = ['then', 'catch'];\n    const promify = promifyMethods.reduce((promise, method) => {\n        promise[method] = callback => {\n            promise[method] = callback;\n            return promise;\n        };\n        return promise;\n    }, {});\n\n    xhr.open(options.method, getURL(options), true);\n    xhr.withCredentials = options.hasOwnProperty('withCredentials');\n    setHeaders(xhr, options.headers);\n    xhr.addEventListener('readystatechange', ready(xhr, promify), false);\n    xhr.send(querify(options.data));\n    promify.abort = () => xhr.abort();\n\n    return promify;\n}\n\nfunction ready(xhr, promify) {\n    return function handleReady() {\n        if (xhr.readyState === xhr.DONE) {\n            xhr.removeEventListener('readystatechange', handleReady, false);\n            const done = xhr.status >= 200 && xhr.status < 300 ? 'then' : 'catch';\n            promify[done].call(promify, toJSON(xhr.responseText));\n        }\n    };\n}\n"],"names":["toJSON","string","JSON","parse","e","querify","object","Object","keys","reduce","prev","current","encodeURIComponent","setHeaders","xhr","headers","hasContentType","map","name","setRequestHeader","some","toLowerCase","getURL","options","method","data","url","queryString","separator","indexOf","request","arguments","methods","connect","assign","log","XMLHttpRequest","promifyMethods","promify","promise","callback","open","withCredentials","hasOwnProperty","addEventListener","ready","send","abort","handleReady","readyState","DONE","removeEventListener","done","status","call","responseText"],"mappings":"4LAAO,SAASA,GAAOC,aAERC,MAAKC,MAAMF,GACpB,MAAOG,SACEH,IAIf,QAAgBI,GAAQC,SACE,gBAAXA,GAA4BA,EAChCC,OAAOC,KAAKF,GAAQG,OAAO,SAACC,EAAMC,UAAaD,EAAUA,UAAgBE,mBAAmBD,GAAW,IAAMC,mBAAmBN,EAAOK,KAAW,IAG7J,QAAgBE,GAAWC,EAAKC,KAClBA,MAELC,EAAeD,KAAUA,EAAQ,gBAAkB,4CAEjDP,KAAKO,GAASE,IAAI,kBAAQF,GAAQG,IAASJ,EAAIK,iBAAiBD,EAAMH,EAAQG,MAGzF,QAAgBF,GAAeD,SACpBR,QAAOC,KAAKO,GAASK,KAAK,kBAA+B,iBAAvBF,EAAKG,gBAGlD,QAAgBC,GAAOC,MACkB,QAAjCA,EAAQC,OAAOH,gBAA4BE,EAAQE,KAAM,MAAOF,GAAQG,OAEtEC,GAActB,EAAQkB,EAAQE,MAC9BG,EAAYL,EAAQG,IAAIG,QAAQ,MAAQ,EAAI,IAAM,UAEjDN,GAAQG,IAAME,EAAYD,EC7BtB,QAASG,GAAQP,GACL,gBAAZA,YAECG,IAAMK,UAAU,MAElBR,QACFE,KAAOF,EAAQE,WACfD,OAASD,EAAQC,QAAU,SAE7BQ,IAAW,MAAO,OAAQ,MAAO,gBAEnCT,GAAQG,IAAYO,EAAQV,GAEzBS,EAAQvB,OAAO,SAACqB,EAASN,YACpBA,GAAU,SAACE,MAAKD,mEAAcQ,GAAQ1B,OAAO2B,OAAOX,6BAKrDO,SAED,0BACMK,IAAI,wDACL5B,OAAO2B,cACH,kBAMvB,QAASD,GAAQV,MACPT,GAAM,GAAIsB,gBACVC,GAAkB,OAAQ,SAC1BC,EAAUD,EAAe5B,OAAO,SAAC8B,EAASf,YACpCA,GAAU,qBACNA,GAAUgB,EACXD,GAEJA,gBAGPE,KAAKlB,EAAQC,OAAQF,EAAOC,IAAU,KACtCmB,gBAAkBnB,EAAQoB,eAAe,qBAClC7B,EAAKS,EAAQR,WACpB6B,iBAAiB,mBAAoBC,EAAM/B,EAAKwB,IAAU,KAC1DQ,KAAKzC,EAAQkB,EAAQE,SACjBsB,MAAQ,iBAAMjC,GAAIiC,SAEnBT,EAGX,QAASO,GAAM/B,EAAKwB,SACT,SAASU,QACRlC,EAAImC,aAAenC,EAAIoC,KAAM,GACzBC,oBAAoB,mBAAoBH,GAAa,MACnDI,GAAOtC,EAAIuC,QAAU,KAAOvC,EAAIuC,OAAS,IAAM,OAAS,UACtDD,GAAME,KAAKhB,EAAStC,EAAOc,EAAIyC"}