{"version":3,"file":"just-request.js","sources":["../src/common.js","../src/index.js"],"sourcesContent":["export function toJSON(string) {\n    try {\n        return JSON.parse(string);\n    } catch (e) {\n        return string;\n    }\n}\n\nexport function querify(object) {\n    if (typeof object === 'string') return object;\n    return Object.keys(object).reduce((prev, current) => (prev ? `${prev}&` : ``) + encodeURIComponent(current) + '=' + encodeURIComponent(object[current]), '');\n}\n\nexport function setHeaders(xhr, headers) {\n    headers = headers || {};\n\n    if (!hasContentType(headers)) headers['Content-Type'] = 'application/x-www-form-urlencoded';\n\n    Object.keys(headers).map(name => headers[name] && xhr.setRequestHeader(name, headers[name]));\n}\n\nexport function hasContentType(headers) {\n    return Object.keys(headers).some(name => name.toLowerCase() === 'content-type');\n}\n\nexport function getURL(options) {\n    if (options.method.toLowerCase() !== 'get' || !options.data) return options.url;\n\n    const queryString = querify(options.data);\n    const separator = options.url.indexOf('?') > -1 ? '&' : '?';\n\n    return options.url + separator + queryString;\n}\n","import { querify, setHeaders, hasContentType, toJSON, getURL } from './common';\n\nexport default function request(options) {\n    if (typeof options === 'string') {\n        options = {};\n        options.url = arguments[0];\n    }\n    options = options || {};\n    options.data = options.data || {};\n    options.method = options.method || 'get';\n\n    const methods = ['get', 'post', 'put', 'delete'];\n\n    if (options.url) return connect(options);\n\n    return methods.reduce((request, method) => {\n        request[method] = (url, data = {}) => connect(Object.assign(options, {\n            method,\n            url,\n            data,\n        }));\n        return request;\n    }, {\n        then: () => {\n            console.log('use request().methodName() to specify request method');\n            return Object.assign({\n                catch: () => {},\n            });\n        },\n    });\n}\n\nfunction connect(options) {\n    const xhr = new XMLHttpRequest();\n    const promifyMethods = ['then', 'catch'];\n    const promify = promifyMethods.reduce((promise, method) => {\n        promise[method] = callback => {\n            promise[method] = callback;\n            return promise;\n        };\n        return promise;\n    }, {});\n\n    xhr.open(options.method, getURL(options), true);\n    xhr.withCredentials = options.hasOwnProperty('withCredentials');\n    setHeaders(xhr, options.headers);\n    xhr.addEventListener('readystatechange', ready(xhr, promify), false);\n    xhr.send(querify(options.data));\n    promify.abort = () => xhr.abort();\n\n    return promify;\n}\n\nfunction ready(xhr, promify) {\n    return function handleReady() {\n        if (xhr.readyState === xhr.DONE) {\n            xhr.removeEventListener('readystatechange', handleReady, false);\n            const done = xhr.status >= 200 && xhr.status < 300 ? 'then' : 'catch';\n            promify[done].call(promify, toJSON(xhr.responseText));\n        }\n    };\n}\n"],"names":["toJSON","string","JSON","parse","e","querify","object","Object","keys","reduce","prev","current","encodeURIComponent","setHeaders","xhr","headers","hasContentType","map","name","setRequestHeader","some","toLowerCase","getURL","options","method","data","url","queryString","separator","indexOf","request","arguments","methods","connect","assign","log","XMLHttpRequest","promifyMethods","promify","promise","callback","open","withCredentials","hasOwnProperty","addEventListener","ready","send","abort","handleReady","readyState","DONE","removeEventListener","done","status","call","responseText"],"mappings":"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"}